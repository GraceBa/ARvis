<!doctype HTML>
<html>
<script src="https://cdn.jsdelivr.net/gh/GraceBa/ARvis/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/GraceBa/ARvis/DNA/aframe-ar.js"></script>

<body style='margin : 0px; overflow: hidden;'>
    <a-scene id="currentScene" embedded arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;' foo>

        <!-- Custom js events -->
        <!-- Control model import -->
        <script type="text/javascript">
            function selectModel() {
                var filename = document.getElementById("userInput").value;

                var object = "https://raw.githubusercontent.com/GraceBa/ARvis/master/DNA/" + filename + ".obj";
                var material = "https://raw.githubusercontent.com/GraceBa/ARvis/master/DNA/" + filename + ".mtl";
                var information = "current file is: " + filename;
                document.getElementById('info').innerHTML = information;

                var display = document.getElementById("model");
                display.setAttribute("obj-model", "obj: url(" + object + "); mtl: url(" + material + ");");
            }

            function hideModel() {
                var display = document.getElementById("model");
                display.setAttribute("obj-model", "obj: url(); mtl: url();");
            }

            function selectMarker() {
                //input the name an location of the new marker
                var markername = document.getElementById("markerInput").value;
                var marker = "https://raw.githubusercontent.com/GraceBa/ARvis/master/MolViewer/Markers/" + markername + ".patt";
             
                //create a new a-marker element
                var a_marker = document.createElement("a-marker");
                var element = document.getElementById("currentScene");
                element.appendChild(a_marker);

                var markernumber = 1;

                // set the preset
                a_marker.setAttribute('preset', 'custom');
                // set the type
                a_marker.setAttribute('type', 'pattern');
                // set the url
                a_marker.setAttribute('url', marker);

                //document.getElementsByTagName("a-marker")[markernumber].setAttribute('url', marker);

                //create a model entity for the marker
          /*      var a_entity = document.createElement("a-box");
                var element = document.getElementById(markernumber.toString());
                element.appendChild(a_entity);*/
                var a_entity = document.createElement("a-entity");
                var element = document.getElementsByTagName("a-marker")[markernumber];
                element.appendChild(a_entity);

                //set id as index
                a_entity.setAttribute('id', markernumber.toString());
                //import default model
                var newObjModel = "obj: url(https://raw.githubusercontent.com/GraceBa/ARvis/master/DNA/dna_chainB.obj); mtl: url(https://raw.githubusercontent.com/GraceBa/ARvis/master/DNA/dna_chainA.mtl);";
                a_entity.setAttribute("obj-model",newObjModel);
                //set the shadow
                a_entity.setAttribute("shadow","recieve: false");
                //set the position
                a_entity.setAttribute("position", "0 1 0");
                //set the scale
                a_entity.setAttribute("scale", "1"); 
  

                /*
                                //create a new a-marker element
                var a_marker = document.createElement("a-marker");
                // set the file name as id
                var newId = document.createAttribute("id");
                newId.value = markername;
                a_marker.setAttribute(newId);
                // set the preset
                var newPreset = document.createAttribute("preset");
                newPreset.value = "custom";
                a_marker.setAttribute(newPreset);
                // set the type
                var newType = document.createAttribute("type");
                newType.value = "pattern";
                a_marker.setAttribute(newType);
                // set the url
                var newUrl = document.createAttribute("url");
                newUrl.value = marker;
                a_marker.setAttribute(newUrl);

                //create a model entity for the marker
                var a_entity = document.createElement("a-entity");
                //import default model
                var newObjModel = document.createAttribute("obj-model");
                newObjModel.value = "obj: url(https://raw.githubusercontent.com/GraceBa/ARvis/master/DNA/dna_chainB.obj); mtl: url(https://raw.githubusercontent.com/GraceBa/ARvis/master/DNA/dna_chainA.mtl);";
                a_entity.setAttribute(newObjModel);
                //set the shadow
                var newShadow = document.createAttribute("shadow");
                newShadow.value = "recieve: false;";
                a_entity.setAttribute(newShadow);
                //set the position
                var newPosition = document.createAttribute("position");
                newPosition.value = "0 1 0";
                a_entity.setAttribute(newShadow);

                //put the new a-entity element in the a-marker
                var element = document.getElementById(newId);
                element.appendChild(a_entity);

                //put the new a-marker element in the scene
                var element1 = document.getElementById("currentScene");
                element1.appendChild(a_marker);
                */


                
            }
        </script>

        <!-- Import model button -->
        <div style='position: fixed; top: 10px; left: 10px; width:100%; text-align: left; z-index: 1;'>
            <input type="text" id="userInput" /> <br />
            <input onclick="selectModel()" type="button" value="import model" id="selectButton"> <br />
            <input onclick="hideModel()" type="button" value="remove model" id="hideButton">

            <script>
            var pressEnter = document.getElementById("userInput");
            pressEnter.addEventListener("keyup", function (event) {
                if (event.keyCode === 13) {
                    document.getElementById("selectButton").click();
                }
            });
            </script>
        </div>

        <!-- Marker select button -->
        <div style='position: fixed; bottom: 40px; left: 10px; width:100%; text-align: left; z-index: 1;'>
            <input type="text" id="markerInput" value="hexP"/> <br />
            <input onclick="selectMarker()" type="button" value="select marker" id="markerButton"> <br />

            <script>
            var pressEnter = document.getElementById("markerInput");
            pressEnter.addEventListener("keyup", function (event) {
                if (event.keyCode === 13) {
                    document.getElementById("markerButton").click();
                }
            });
            </script>
        </div>


        <!-- display information on active model -->
        <div style='position: fixed; bottom: 10px; left: 10px; width:100%; text-align: left; z-index: 1;'>
            <a id="info"></a>
        </div>


        <!-- control scale and rotation
    <script src="https://cdn.jsdelivr.net/gh/GraceBa/ARvis/DNA/hammer.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/GraceBa/ARvis/DNA/controlHammer.js"></script> -->
 
        <!-- Recognise image -->
        <a-marker id="0" preset="custom" type="pattern" url="https://raw.githubusercontent.com/GraceBa/ARvis/master/MolViewer/Markers/smileyP.patt">
            <!-- Overlay object -->
            <a-entity obj-model="obj: url(https://raw.githubusercontent.com/GraceBa/ARvis/master/DNA/dna_chainB.obj); mtl: url(https://raw.githubusercontent.com/GraceBa/ARvis/master/DNA/dna_chainA.mtl);" shadow="recieve: false;" position="0 1 0" scale="1" id="model"></a-entity>
        </a-marker>

        <!-- Initiate camera -->
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>
